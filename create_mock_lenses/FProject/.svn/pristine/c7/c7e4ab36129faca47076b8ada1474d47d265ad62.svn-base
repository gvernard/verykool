<?php
error_reporting(E_ALL);
ini_set('display_errors','1');
include("/Users/users/gvernard/myLibraries/myInc/db_conns.inc.php");

$conn = argoDB();
//$id = $argv[1];
echo "Give ID of simulated lens: ";
$h = fopen("php://stdin","r");
$line = fgets($h);
$id = trim($line);
fclose($h);




$qstr   = "SELECT * FROM mock_lenses WHERE id=$id";
$result = mysqli_query($conn,$qstr);
$row    = mysqli_fetch_assoc($result);

if( mysqli_num_rows($result) == 0 ){
    echo "Invalid ID!\n";
    exit;
}


$jarr = array();
$jarr["output"] = "/Users/users/gvernard/myCodes/FProject/output/";
$jarr["iplane"] = array("pix_x"=>200,"pix_y"=>200,"siz_x"=>20.,"siz_y"=>20.);
$jarr["triangles"] = array("Nx"=>50,"Ny"=>50,"sel_radius"=>0.2);
$jarr["sources"]   = array();
$jarr["sources"][0] = array("type"=>$row['s_model'],"randomize"=>0,"x0"=>$row["s_x0"],"y0"=>$row["s_y0"],"pa"=>$row["s_pa"],"q"=>$row["s_q"],"reff"=>$row["s_reff"],"ieff"=>$row["s_ieff"],"index"=>$row["s_n"]);
$jarr["mmodel"]    = $row["l_model"];
$jarr["nlpars"]    = array();
$jarr["nlpars"][0] = array("name"=>"b","value"=>$row["l_b"]);
$jarr["nlpars"][1] = array("name"=>"q","value"=>$row["l_q"]);
$jarr["nlpars"][2] = array("name"=>"pa","value"=>$row["l_pa"]);
$jarr["nlpars"][3] = array("name"=>"xl","value"=>0.);
$jarr["nlpars"][4] = array("name"=>"yl","value"=>0.);
$jarr["nlpars"][5] = array("name"=>"g","value"=>$row["l_g"]);
$jarr["nlpars"][6] = array("name"=>"phi","value"=>$row["l_g_pa"]);


$fh = fopen('/Users/users/gvernard/myCodes/FProject/input/' . $id . '.json','w');
fwrite($fh,json_encode($jarr,JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES | JSON_NUMERIC_CHECK));
fclose($fh);

destroyDB();

echo "Done!";

?>

